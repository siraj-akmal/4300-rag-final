mflixdb.movies.aggregate([ {"$match": {"year": {"$lte": 1920}}}, {"$sort": {"imdb.rating": -1}}, {"$limit": 5}, {"$unwind": "$cast"}, {"$project": {"_id":0, "title": 1, "cast": 1, "rating": "$imdb.rating"}}, ]) print(dumps(c, indent=4)) Grouping # What is the average IMDB rating of all movies by year? sort the data by year. c = mflixdb.movies.aggregate([ {"$group": {"_id": {"release year": "$year"}, "Avg Rating": {"$avg": "$imdb.rating"}}}, {"$sort" : {"_id": 1}} ]) print(dumps(c, indent = 2)) # What is the average IMDB rating of all movies by year? sort the data by avg rating in decreasing order. c = mflixdb.movies.aggregate([ {"$group": {"_id": {"release year": "$year"}, "Avg Rating": {"$avg": "$imdb.rating"}}}, {"$sort" : {"Avg Rating": -1, "_id": 1}} ]) print(dumps(c, indent = 2)) Lookup data = demodb.customers.aggregate([ { "$lookup": { "from": "orders", "localField": "custid", "foreignField": "custid", "as": "orders" } }, {"$project": {"_id": 0, "address": 0}} ]) print(dumps(data, indent = 2)) Reformatting Queries match = {"$match": {"year": {"$lte": 1920}}} limit = {"$limit": 5} project = {"$project": {"_id":0, "title": 1, "cast": 1, "rating": "$imdb.rating"}} agg = mflixdb.movies.aggregate([match, limit, project]) print(dumps(agg, indent=2))